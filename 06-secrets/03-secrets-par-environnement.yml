# ============================================================
# DÃ‰MO 3/3 â€” Secrets : secrets par environnement
# ============================================================
# GitHub permet de crÃ©er des secrets DIFFÃ‰RENTS selon
# l'environnement (staging, production).
#
# Chaque environnement peut avoir :
#   - ses propres secrets (ex: URL de staging â‰  URL de prod)
#   - des rÃ¨gles de protection (approbation manuelle requise)
#
# Configuration :
#   Settings â†’ Environments â†’ New environment
#   â†’ Ajouter les secrets dans chaque environnement
#
# Environnements nÃ©cessaires pour cette dÃ©mo :
#   staging    (avec secret : API_URL = https://api-staging.example.com)
#   production (avec secret : API_URL = https://api.example.com)
# ============================================================

name: "23 Â· Secrets par environnement"

on: workflow_dispatch

jobs:

  # â”€â”€â”€ DÃ©ploiement STAGING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  deploy-staging:
    name: "ğŸŒ DÃ©ployer en Staging"
    runs-on: ubuntu-latest
    environment: staging            # â† secrets de l'env "staging"

    steps:
      - name: "ğŸ”‘ Utiliser les secrets de staging"
        env:
          API_URL: ${{ secrets.API_URL }}   # valeur de l'env "staging"
        run: |
          echo "=== DÃ©ploiement STAGING ==="
          echo "API URL : $API_URL"
          echo "âœ… DÃ©ployÃ© en staging"

  # â”€â”€â”€ DÃ©ploiement PRODUCTION (attend staging) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  deploy-production:
    name: "ğŸš€ DÃ©ployer en Production"
    runs-on: ubuntu-latest
    needs: deploy-staging           # â† attend que staging rÃ©ussisse
    environment:
      name: production              # â† secrets de l'env "production"
      url: https://mon-app.example.com

    steps:
      - name: "ğŸ”‘ Utiliser les secrets de production"
        env:
          API_URL: ${{ secrets.API_URL }}   # valeur de l'env "production"
        run: |
          echo "=== DÃ©ploiement PRODUCTION ==="
          echo "API URL : $API_URL"
          echo "ğŸš€ Application dÃ©ployÃ©e en production !"
