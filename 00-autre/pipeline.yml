# =============================================================
# TP CORRIGÃ‰ â€” Pipeline CI/CD complet Â· utopios-app
# Concepts : dÃ©clencheurs Â· jobs & steps Â· needs
# =============================================================

name: "Pipeline CI/CD Â· utopios-app"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ã‰TAPE 1 â€” DÃ‰CLENCHEURS
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  push:
    branches:
      - main
      - develop

  pull_request:
    branches:
      - main

  workflow_dispatch:
    inputs:
      environment:
        description: "Environnement cible"
        required: true
        type: choice
        options:
          - staging
          - production

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ã‰TAPES 2 & 3 â€” JOBS, STEPS ET ORCHESTRATION
#
#   lint â”€â”€â”
#          â”œâ”€â”€â†’ build â”€â”€â†’ deploy (main uniquement)
#   tests â”€â”˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
jobs:

  lint:
    name: "ğŸ¨ Lint â€” VÃ©rification du style"
    runs-on: ubuntu-latest
    steps:
      - name: "Analyser le style du code"
        run: |
          echo "Analyse du style en cours..."
          sleep 2

      - name: "Confirmer le rÃ©sultat"
        run: echo "âœ… Aucune erreur de style dÃ©tectÃ©e"

  tests:
    name: "ğŸ§ª Tests â€” Tests automatisÃ©s"
    runs-on: ubuntu-latest
    steps:
      - name: "PrÃ©parer les tests"
        run: echo "Lancement des tests..."

      - name: "ExÃ©cuter les tests"
        run: |
          sleep 4
          echo "âœ… 21 tests passÃ©s, 0 Ã©chouÃ©"

      - name: "GÃ©nÃ©rer le rapport de tests"
        if: always()
        run: echo "Rapport de tests gÃ©nÃ©rÃ©"

  build:
    name: "ğŸ”¨ Build â€” Compilation"
    runs-on: ubuntu-latest
    needs: [lint, tests]
    steps:
      - name: "Compiler l'application"
        run: |
          echo "Compilation de utopios-app..."
          sleep 3

      - name: "Confirmer le build"
        run: echo "âœ… Build rÃ©ussi â€” artefact prÃªt"

  deploy:
    name: "ğŸš€ Deploy â€” DÃ©ploiement"
    runs-on: ubuntu-latest
    needs: build
    if: github.ref_name == 'main'
    steps:
      - name: "DÃ©ployer l'application"
        run: |
          ENV="${{ inputs.environment }}"
          echo "DÃ©ploiement sur ${ENV:-staging}..."

      - name: "Confirmer le dÃ©ploiement"
        run: echo "âœ… utopios-app est en ligne !"
