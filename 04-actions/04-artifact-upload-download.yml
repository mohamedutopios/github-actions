# ============================================================
# DÃ‰MO 4/4 â€” Actions : upload-artifact + download-artifact
# ============================================================
# Les artifacts permettent de :
#   - sauvegarder des fichiers produits pendant le workflow
#   - les partager entre deux jobs (machines diffÃ©rentes !)
#   - les tÃ©lÃ©charger depuis l'onglet Actions de GitHub
#
# Workflow :
#   Job "build"  â†’ produit un fichier â†’ l'uploade
#   Job "deploy" â†’ le tÃ©lÃ©charge     â†’ l'utilise
# ============================================================

name: "16 Â· Artifacts upload + download"

on: workflow_dispatch

jobs:

  # â”€â”€â”€ JOB 1 : CrÃ©e et uploade un artifact â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  build:
    name: "ğŸ“¦ Build + Upload artifact"
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ”¨ Simuler un build (crÃ©er des fichiers)"
        run: |
          mkdir -p dist
          echo "Application compilÃ©e â€” Run ${{ github.run_number }}" > dist/app.js
          echo "Version : 1.0.${{ github.run_number }}"             > dist/version.txt
          ls -la dist/

      - name: "â¬†ï¸ Uploader l'artifact 'build-dist'"
        uses: actions/upload-artifact@v4
        with:
          name: build-dist            # nom de l'artifact dans GitHub
          path: dist/                 # dossier Ã  sauvegarder
          retention-days: 7           # conservÃ© 7 jours (90 par dÃ©faut)

  # â”€â”€â”€ JOB 2 : TÃ©lÃ©charge et utilise l'artifact â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  deploy:
    name: "ğŸš€ Download artifact + Deploy"
    runs-on: ubuntu-latest
    needs: build                      # attend que build soit terminÃ©

    steps:
      - name: "â¬‡ï¸ TÃ©lÃ©charger l'artifact 'build-dist'"
        uses: actions/download-artifact@v4
        with:
          name: build-dist            # mÃªme nom qu'Ã  l'upload
          path: ./dist-telecharge/    # oÃ¹ le dÃ©poser localement

      - name: "ğŸ” VÃ©rifier le contenu reÃ§u"
        run: |
          echo "Fichiers reÃ§us :"
          ls -la dist-telecharge/
          echo ""
          echo "Contenu de app.js :"
          cat dist-telecharge/app.js
