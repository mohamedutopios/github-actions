# ============================================================
# DÃ‰MO 3/4 â€” Variables : sortie dynamique entre steps
# ============================================================
# Un step peut PRODUIRE une valeur qu'un step suivant
# peut LIRE. MÃ©canisme : GITHUB_OUTPUT
#
# Ã‰crire une valeur (dans step A) :
#   echo "ma_cle=ma_valeur" >> $GITHUB_OUTPUT
#
# Lire la valeur (dans step B) :
#   ${{ steps.id_step_a.outputs.ma_cle }}
#
# TrÃ¨s utile pour passer des infos entre steps :
# version calculÃ©e, numÃ©ro de build, date, etc.
# ============================================================

name: "19 Â· Sorties dynamiques entre steps"

on: workflow_dispatch

jobs:
  demo-outputs:
    name: "Passer des valeurs entre steps"
    runs-on: ubuntu-latest

    steps:
      # Step A â€” Produit deux valeurs de sortie
      - name: "ğŸ·ï¸ Step A â€” Calculer la version"
        id: calcul-version           # â† l'id permet de rÃ©fÃ©rencer ce step
        run: |
          DATE=$(date +%Y%m%d)
          VERSION="1.0.${{ github.run_number }}"
          echo "ğŸ“Œ Version calculÃ©e : $VERSION"
          echo "ğŸ“Œ Date du build    : $DATE"

          # Ã‰crire les sorties dans GITHUB_OUTPUT
          echo "version=$VERSION"  >> $GITHUB_OUTPUT
          echo "date_build=$DATE"  >> $GITHUB_OUTPUT

      # Step B â€” Lit les valeurs produites par step A
      - name: "ğŸ“– Step B â€” Utiliser la version calculÃ©e"
        run: |
          echo "=== Valeurs reÃ§ues depuis Step A ==="
          echo "Version    : ${{ steps.calcul-version.outputs.version }}"
          echo "Date build : ${{ steps.calcul-version.outputs.date_build }}"

      # Step C â€” Utilise aussi les valeurs
      - name: "ğŸ·ï¸ Step C â€” CrÃ©er un tag avec la version"
        run: |
          VERSION="${{ steps.calcul-version.outputs.version }}"
          echo "Tag qui serait crÃ©Ã© : v$VERSION"
          echo "Image Docker : mon-app:$VERSION"
