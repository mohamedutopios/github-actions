# ============================================================
# DÃ‰MO 4/4 â€” Variables : conditions et expressions
# ============================================================
# Les variables peuvent Ãªtre utilisÃ©es dans des conditions
# if: pour rendre le workflow dynamique.
#
# Expressions disponibles :
#   == != < > <= >=          comparaisons
#   && ||                    ET / OU
#   contains(str, substr)    contient
#   startsWith(str, prefix)  commence par
#   endsWith(str, suffix)    se termine par
# ============================================================

name: "20 Â· Variables dans les conditions if:"

on:
  push:
  workflow_dispatch:

env:
  ENVIRONNEMENT: "staging"

jobs:
  demo-conditions:
    name: "Conditions basÃ©es sur des variables"
    runs-on: ubuntu-latest

    steps:
      - name: "âœ… Toujours exÃ©cutÃ©"
        run: echo "Branch : ${{ github.ref_name }}"

      - name: "ğŸ  ExÃ©cutÃ© UNIQUEMENT sur main"
        if: github.ref_name == 'main'
        run: echo "Je tourne seulement sur la branche main"

      - name: "ğŸŒ¿ ExÃ©cutÃ© sur toutes les branches SAUF main"
        if: github.ref_name != 'main'
        run: echo "Je tourne sur la branche ${{ github.ref_name }} (pas main)"

      - name: "ğŸ·ï¸ ExÃ©cutÃ© seulement sur un tag (v*)"
        if: startsWith(github.ref, 'refs/tags/v')
        run: echo "Tag dÃ©tectÃ© : ${{ github.ref_name }}"

      - name: "ğŸš€ DÃ©ploiement conditionnel (push + main)"
        if: github.event_name == 'push' && github.ref_name == 'main'
        run: |
          echo "Conditions rÃ©unies : push sur main"
          echo "â†’ DÃ©ploiement autorisÃ©"

      - name: "ğŸŒ Afficher l'environnement cible"
        run: |
          echo "Environnement cible : $ENVIRONNEMENT"
          if [ "$ENVIRONNEMENT" = "production" ]; then
            echo "âš ï¸  ATTENTION : dÃ©ploiement en PRODUCTION"
          else
            echo "â„¹ï¸  DÃ©ploiement en staging (sans risque)"
          fi
