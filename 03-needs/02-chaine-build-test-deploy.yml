# ============================================================
# DÃ‰MO 2/3 â€” needs : chaÃ®ne complÃ¨te build â†’ test â†’ deploy
# ============================================================
# Un pipeline CI/CD rÃ©aliste en 3 Ã©tapes :
#
#   build â”€â”€â†’ tests â”€â”€â†’ deploiement
#
# Chaque job attend le prÃ©cÃ©dent. Si l'un Ã©choue,
# toute la chaÃ®ne s'arrÃªte.
# ============================================================

name: "11 Â· needs â€” chaÃ®ne build â†’ test â†’ deploy"

on: workflow_dispatch

jobs:

  # â”€â”€â”€ Ã‰TAPE 1 : Build â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  build:
    name: "ğŸ”¨ 1 Â· Build"
    runs-on: ubuntu-latest
    steps:
      - name: Compiler l'application
        run: |
          echo "ğŸ“¦ Compilation en cours..."
          sleep 2
          echo "âœ… Build rÃ©ussi"

  # â”€â”€â”€ Ã‰TAPE 2 : Tests (attend build) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  tests:
    name: "ğŸ§ª 2 Â· Tests"
    runs-on: ubuntu-latest
    needs: build                   # â† attend build
    steps:
      - name: Lancer les tests
        run: |
          echo "ğŸ§ª Tests en cours..."
          sleep 2
          echo "âœ… 24 tests passÃ©s"

  # â”€â”€â”€ Ã‰TAPE 3 : Deploy (attend tests) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  deploiement:
    name: "ğŸš€ 3 Â· DÃ©ploiement"
    runs-on: ubuntu-latest
    needs: tests                   # â† attend tests (et donc build implicitement)
    steps:
      - name: DÃ©ployer en production
        run: |
          echo "ğŸš€ DÃ©ploiement en production..."
          sleep 1
          echo "âœ… Application en ligne !"
