# ============================================================
# DÃ‰MO 3/4 â€” Actions : setup-dotnet + cache NuGet
# ============================================================
# "actions/setup-dotnet" installe le SDK .NET sur la machine.
#
# ParamÃ¨tres importants :
#   dotnet-version : "8.0.x", "9.0.x"â€¦
#                    Le "x" signifie "derniÃ¨re version stable
#                    du patch" â€” recommandÃ© pour toujours
#                    avoir les correctifs de sÃ©curitÃ©
#   cache          : true pour mettre ~/.nuget en cache
#                    et Ã©viter de retÃ©lÃ©charger les packages
# ============================================================

name: "15 Â· Action setup-dotnet"

on: workflow_dispatch

jobs:
  demo-dotnet:
    name: "setup-dotnet avec cache NuGet"
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ“¥ Checkout"
        uses: actions/checkout@v4

      - name: "âš™ï¸ Configurer .NET 8 avec cache NuGet"
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: "8.0.x"    # derniÃ¨re version stable de .NET 8
          cache: true                # met ~/.nuget/packages en cache

      - name: "ğŸ” VÃ©rifier la version installÃ©e"
        run: |
          echo ".NET SDK  : $(dotnet --version)"
          echo "Runtime   : $(dotnet --list-runtimes | head -1)"

      - name: "ğŸ”¨ Builder avec dotnet (si .csproj existe)"
        run: |
          if [ -f *.csproj ] || [ -f **/*.csproj ] 2>/dev/null; then
            dotnet build --configuration Release
            echo "âœ… Build .NET rÃ©ussi"
          else
            echo "â„¹ï¸ Pas de .csproj dans ce dÃ©pÃ´t"
          fi

      - name: "ğŸ§ª Lancer les tests (si projet de test existe)"
        run: |
          if find . -name "*.Tests.csproj" -o -name "*Tests.csproj" | grep -q .; then
            dotnet test --no-build --configuration Release
            echo "âœ… Tests .NET rÃ©ussis"
          else
            echo "â„¹ï¸ Pas de projet de tests dÃ©tectÃ©"
          fi
